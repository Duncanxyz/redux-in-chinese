<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Redux 中文官网 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Redux 中文官网 Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-66122997-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Redux 中文官网" href="/opensearch.xml"><title data-react-helmet="true">Redux 深入浅出, 第 7 节: 标准 Redux 模式 | Redux 中文官网</title><meta data-react-helmet="true" property="og:url" content="http://cn.redux.js.org/tutorials/fundamentals/part-7-standard-patterns"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Redux 深入浅出, 第 7 节: 标准 Redux 模式 | Redux 中文官网"><meta data-react-helmet="true" name="description" content="The official Fundamentals tutorial for Redux: learn the standard patterns used in real-world Redux apps"><meta data-react-helmet="true" property="og:description" content="The official Fundamentals tutorial for Redux: learn the standard patterns used in real-world Redux apps"><meta data-react-helmet="true" property="og:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-react-helmet="true" name="twitter:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://cn.redux.js.org/tutorials/fundamentals/part-7-standard-patterns"><link data-react-helmet="true" rel="alternate" href="http://cn.redux.js.org/tutorials/fundamentals/part-7-standard-patterns" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://cn.redux.js.org/tutorials/fundamentals/part-7-standard-patterns" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a0cae3ae.css">
<link rel="preload" href="/assets/js/runtime~main.9044bd3c.js" as="script">
<link rel="preload" href="/assets/js/main.983ddc03.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Redux 中文官网</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction/getting-started">入门</a><a class="navbar__item navbar__link" href="/tutorials/essentials/part-1-overview-concepts">教程</a><a class="navbar__item navbar__link" href="/api/api-reference">API</a><a class="navbar__item navbar__link" href="/faq">常见问题</a><a class="navbar__item navbar__link" href="/style-guide/style-guide">最佳实践</a><a href="https://www.github.com/camsong/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">源码</a><a href="https://github.com/camsong/redux-in-chinese/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">纠错</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Redux 中文官网</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/introduction/getting-started">入门</a></li><li class="menu__list-item"><a class="menu__link" href="/tutorials/essentials/part-1-overview-concepts">教程</a></li><li class="menu__list-item"><a class="menu__link" href="/api/api-reference">API</a></li><li class="menu__list-item"><a class="menu__link" href="/faq">常见问题</a></li><li class="menu__list-item"><a class="menu__link" href="/style-guide/style-guide">最佳实践</a></li><li class="menu__list-item"><a href="https://www.github.com/camsong/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="menu__link">源码</a></li><li class="menu__list-item"><a href="https://github.com/camsong/redux-in-chinese/issues" target="_blank" rel="noopener noreferrer" class="menu__link">纠错</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">简介</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/introduction/getting-started">入门 Redux</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/introduction/installation">安装</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/introduction/core-concepts">核心概念</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/introduction/learning-resources">学习资源</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/introduction/ecosystem">生态</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/introduction/examples">示例</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">教程</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/index">教程目录</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Redux 循序渐进</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tutorials/essentials/part-1-overview-concepts">基础概念</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tutorials/essentials/part-2-app-structure">应用结构</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tutorials/essentials/part-3-data-flow">数据流基础</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tutorials/essentials/part-4-using-data">使用数据</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tutorials/essentials/part-5-async-logic">异步逻辑与数据请求</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tutorials/essentials/part-6-performance-normalization">性能与数据范式化</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Redux 深入浅出</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-1-overview">Redux 概览</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-2-concepts-data-flow">Redux 概念与数据流</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-3-state-actions-reducers">State, Actions, and Reducers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-4-store">Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-5-ui-react">UI and React</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-6-async-logic">Async Logic and Data Fetching</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/tutorials/fundamentals/part-7-standard-patterns">标准 Redux 模式</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-8-modern-redux">Modern Redux with Redux Toolkit</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">技巧</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/recipe-index">技巧</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/configuring-your-store">配置 Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/usage-with-typescript">Usage with TypeScript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/migrating-to-redux">迁移到 Redux</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/using-object-spread-operator">使用对象展开运算符</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/reducing-boilerplate">减少样板代码</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/server-rendering">服务端渲染</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/writing-tests">编写测试</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/computing-derived-data">计算衍生数据</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/implementing-undo-history">实现撤销重做</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/isolating-redux-sub-apps">子应用隔离</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/code-splitting">代码分割</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/troubleshooting">Troubleshooting</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">组织 Reducers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/structuring-reducers">组织 Reducer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/prerequisite-concepts">Reducer 必备概念</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/basic-reducer-structure">Reducer 和 State 的基本结构</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/splitting-reducer-logic">拆分 Reducer 逻辑</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/refactoring-reducer-example">重构 Reducer：基于函数分解（Functional Decomposition）和 Reducer 组合</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/using-combinereducers">`combineReducers` 用法</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/beyond-combinereducers">`combineReducers` 进阶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/normalizing-state-shape">State 范式化</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/updating-normalized-data">管理范式化数据</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/reusing-reducer-logic">Reducer 逻辑复用</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/immutable-update-patterns">Immutable 不可变更新模式</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/recipes/structuring-reducers/initializing-state">初始化 State</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">深入理解 Redux</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">像 Redux 一样思考</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/understanding/thinking-in-redux/motivation">动机</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/understanding/thinking-in-redux/three-principles">三大原则</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/understanding/thinking-in-redux/glossary">词汇表</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">历史与设计原则</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/understanding/history-and-design/prior-art">先前技术</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/understanding/history-and-design/middleware">Middleware 中间件</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">常见问题</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq">Redux FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/general">Redux FAQ: General</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/reducers">Redux FAQ: Reducers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/organizing-state">Redux FAQ: Organizing State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/store-setup">Redux FAQ: Store Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/actions">Redux FAQ: Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/immutable-data">Redux FAQ: Immutable Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/code-structure">Redux FAQ: Code Structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/performance">Redux FAQ: Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/design-decisions">Redux FAQ: Design Decisions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/react-redux">Redux FAQ: React Redux</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/faq/miscellaneous">Redux FAQ: Miscellaneous</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">编码规范</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/style-guide/style-guide">Style Guide: Best Practices</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API 文档</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/api/api-reference">API Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/api/createstore">createStore</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/api/store">Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/api/combinereducers">combineReducers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/api/applymiddleware">applyMiddleware</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/api/bindactioncreators">bindActionCreators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/api/compose">compose</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Redux Toolkit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/redux-toolkit/overview">Redux Toolkit: 概览</a></li></ul></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Redux 深入浅出, 第 7 节: 标准 Redux 模式</h1></header><div class="markdown"><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>你将学到</h5></div><div class="admonition-content"><ul><li>实际应用 Redux 时的标准模式，以及为什么这些模式会存在<ul><li>使用 Action creators 封装 action 对象</li><li>记忆化 selectors 以提高性能</li><li>通过加载枚举值跟踪请求状态</li><li>规范化状态以管理项目集合</li><li>与 promises 和 thunks 一起工作</li></ul></li></ul></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>前提</h5></div><div class="admonition-content"><ul><li>理解了之前所有小节的内容</li></ul></div></div><p>在<a href="/tutorials/fundamentals/part-6-async-logic">第 6 节：异步逻辑和数据请求</a>，我们看见了怎样使用 Redux 中间件编写异步逻辑来与 store 进行交互。我们使用 Redux &quot;thunk&quot; 中间件来编写可以包含可重用异步逻辑的函数，而无需提前知道他们将要与哪些 Redux store 进行通信。</p><p>到目前为止，我们已经介绍了 Redux 实际工作原理的基础知识。但是，现实世界的 Redux 应用程序在这些基础知识的基础上使用了一些额外的模式。</p><p>重要的是要注意，<strong>这些模式都不是使用 Redux 所必需的！</strong> 但是，这些模式中的每一个都存在很好的理由，并且您将在几乎每个 Redux 代码库中看到部分或全部模式。</p><p>在本节中，我们将重做现有的待办事项应用代码以使用其中一些模式，并讨论为什么它们在 Redux 应用中常用。然后在<a href="/tutorials/fundamentals/part-8-modern-redux"><strong>第 8 节</strong></a>，我们将讨论“现代化 Redux”，包括怎样使用我们的官方 <a href="https://redux-toolkit.js.org" target="_blank" rel="noopener noreferrer">Redux Toolkit</a> 库简化我们已写的 Redux 逻辑。以及为什么<strong>我们建议使用 Redux Toolkit 作为编写 Redux 应用的标准方法</strong>。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="action-creators"></a>Action Creators<a class="hash-link" href="#action-creators" title="Direct link to heading">#</a></h2><p>在我们的应用中，我们总是在 dispatch 的地方字面量地直接写 action 对象：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> trimmedText </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>但是，在实践中，编写良好的 Redux 应用在我们 dispatch 这些 action 对象时实际上不会以内联方式编写它们。相反，我们使用 &quot;action creator&quot; 函数。</p><p>&quot;action creator&quot; 就是一个创建并返回一个 action object 的函数。我们通常使用它们，因此我们不必每次都手动编写操作对象：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">todoAdded</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">text</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> text</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>我们<strong>调用这个 action creator</strong>，然后<strong>把返回值直接传给 <code>dispatch</code></strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">todoAdded</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;Buy milk&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">getState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// [ {id: 0, text: &#x27;Buy milk&#x27;, completed: false}]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><details class="detailed-explanation"><summary><h4>Detailed Explanation: 为什么使用 Action Creators?</h4></summary><p>在我们的小型 todo 应用中，每次都直接写 action 对象不是啥难事。实际上，在使用 action creators 的方式后，我们已经做了 <em>额外</em> 的工作了 - 我们已经写了一个函数 <em>和</em> 一个 action 对象。</p><p>但是，假如我们需要在应用程序的多个地方 dispatch 相同的 action ？或者假如当我们每次 dispatch 一个 action 时都要做一些额外的逻辑，比如创建一个唯一的 ID ？我们最终将不得不在每次需要调度该操作时复制粘贴其他设置逻辑。</p><p>Action creators 操作创建者有两个主要用途：:</p><ul><li>准备和格式化 action 对象的内容</li><li>每当我们创建 action 时，封装所需的任何其他工作</li></ul><p>这样，我们就有了一致的方法来创建 action，无论是否有任何额外的工作需要完成。thunk 也是一样的目的。</p></details><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="using-action-creators"></a>Using Action Creators<a class="hash-link" href="#using-action-creators" title="Direct link to heading">#</a></h3><p>让我们更新一下 todosSlice 文件，以便为几种 action 类型使用 action creators。</p><p>我们将从到目前为止一直使用的两个主要操作开始：从服务器加载待办事项列表，以及在将其保存到服务器后添加新的待办事项。</p><p>当下, <code>todosSlice.js</code> 里直接 dispatch 一个 action 对象，如下：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>我们将创建一个函数，该函数创建并返回相同类型的 action 对象，但接受 todos 数组作为其参数，并将其作为 <code>action.payload</code> 放入 action 中。然后，我们可以使用 <code>fetchTodos </code>thunk 中的新 action creator 来 dispatch action：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">todosLoaded</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> todos</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">todosLoaded</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>我们也为 &quot;todo added&quot; action 做一样的事情:</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">todoAdded</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> todo</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">saveNewTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">text</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">saveNewTodoThunk</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialTodo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> text </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">post</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">todo</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> initialTodo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">todoAdded</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todo</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>再为 &quot;color filter changed&quot; action 做一样的事情:</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/filters/filtersSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">colorFilterChanged</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">color</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> changeType</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;filters/colorFilterChanged&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> color</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> changeType </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>由于此 action 是从 <code>&lt;Footer&gt;</code> 组件 dispatch 的，因此我们需要将 <code>colorFilterChanged</code> 导入到该处并使用它：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/footer/Footer.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> useSelector</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> useDispatch </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> availableColors</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> capitalize </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../filters/colors&#x27;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">StatusFilters</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> colorFilterChanged </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../filters/filtersSlice&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// omit child components</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">Footer</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useDispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todosRemaining </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> uncompletedTodos </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">filter</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> uncompletedTodos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">length</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> status</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> colors </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">onMarkCompletedClicked</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/allCompleted&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">onClearCompletedClicked</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/completedCleared&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">onColorChange</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">color</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> changeType</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">colorFilterChanged</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">color</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> changeType</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">onStatusChange</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">status</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;filters/statusFilterChanged&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> status </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// omit rendering output</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token maybe-class-name">Footer</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>请注意，<code>colorFilterChanged</code> action creator 实际上接受两个不同的参数，然后将它们组合在一起以形成正确的 <code>action.payload</code> 字段。</p><p>这不会改变应用程序的工作方式或 Redux 数据流的行为方式 - 我们仍在创建 action 对象并 dispatch 它们。但是，我们现在不是一直直接在代码中编写 action 对象，而是使用 action creator 在 dispatch 这些 action 对象之前对其进行准备。</p><p>我们也可以结合 thunk 函数使用 action creators，实际上<a href="/tutorials/fundamentals/part-6-async-logic#saving-todo-items">在之前的章节我们已经在 action creator 内包裹了一个 thunk 了</a>。我们专门将 <code>saveNewTodo</code> 包装在 &quot;thunk action creator&quot; 函数中，以便我们可以传入 <code>text</code> 参数。虽然 <code>fetchTodos</code> 不采用任何参数，但我们仍然可以将其包装在操作创建器中：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchTodosThunk</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">todosLoaded</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>这意味着我们必须更改它在 <code>index.js</code> 中 dispatch 的位置以调用外部 thunk action creator 函数，并将返回的内部 thunk 函数传递给 <code>dispatch</code>：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/index.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">store</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./store&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> fetchTodos </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./features/todos/todosSlice&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">fetchTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>到目前为止，我们已经使用 <code>function</code> 关键字编写了 thunks，以明确他们在做什么。但是，我们也可以使用箭头函数语法来编写它们。使用隐式返回可以缩短代码，尽管如果您不熟悉箭头函数，它也可能使阅读变得有点困难：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// Same thing as the above example!</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">fetchTodos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">todosLoaded</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>同样，如果我们愿意，我们 <em>可以</em> 缩短 action creators：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">todoAdded</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> todo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>由您决定以这种方式使用箭头函数是否更好。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>有关 action creators 为何有用的更多详细信息，请参阅：</p><ul><li><a href="https://blog.isquaredsoftware.com/2016/10/idiomatic-redux-why-use-action-creators/" target="_blank" rel="noopener noreferrer">Idiomatic Redux: Why Use Action Creators?</a></li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="记忆化-selectors"></a>记忆化 Selectors<a class="hash-link" href="#记忆化-selectors" title="Direct link to heading">#</a></h2><p>我们已经看到我们可以编写 &quot;selector&quot; 函数，它接受 Redux <code>state</code> 对象作为参数，并返回一个值：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectTodos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>假如我们需要 <em>派生</em> 一些数据怎么办？举个例子，或许我们希望只要一个 todo IDs 组成的数组：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectTodoIds</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>然而，<code>array.map()</code> 每次都返回的是一个新数组引用（reference）。我们知道 <em>每次</em> dispatch action 后 React-Redux <code>useSelector</code> hook 都会重新调用其 selector 函数，如果 selector 返回一个新值，组件一定会重新渲染。</p><p>在这个例子中，<strong>在 <em>每个</em> action 后调用 <code>useSelector(selectTodoIds)</code> 将 <em>总是</em> 造成重渲染，因为总是返回一个新数组引用`</strong></p><p>在第 5 节，我们看到<a href="/tutorials/fundamentals/part-5-ui-react#selecting-data-in-list-items-by-id">我们传了 <code>shallowEqual</code> 作为参数给 <code>useSelector</code></a>。现在有另一选择：我们可以使用 “记忆化的（memoized）” selectors。</p><p><strong>记忆化</strong> 是缓存技术的一种 - 具体来说，保存昂贵计算的结果，如果我们以后看到相同的输入，请重用这些结果。</p><p><strong>记忆化 selector functions</strong> 是保存最新结果值的 selector，如果使用相同的输入多次调用它们，则将返回相同的结果值。如果使用与上次不同的 <em>different</em> 输入调用它们，它们将重新计算新的结果值，缓存该值，然后返回新结果。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="结合-createselector-记忆化-selectors"></a>结合 <code>createSelector</code> 记忆化 Selectors<a class="hash-link" href="#结合-createselector-记忆化-selectors" title="Direct link to heading">#</a></h3><p><strong><a href="https://github.com/reduxjs/reselect" target="_blank" rel="noopener noreferrer">Reselect library</a> 提供了一个能生成记忆化 selector 函数的 <code>createSelector</code> API</strong>。该 API 接收一个或多个 &quot;input selector&quot; 函数作为参数，加上一个 &quot;output selector&quot;，并返回新的 selector 函数。每次调用选择器时：</p><ul><li>所有 &quot;input selectors&quot; 都使用所有参数调用</li><li>如果任何 input selector 返回值已更改，&quot;output selector&quot; 将重新运行</li><li>所有 input selector 的结果都将成为 output selector 的参数</li><li>output selector 的最终结果将缓存以供下次使用</li></ul><p>让我们来创建一个记忆化版的 <code>selectTodoIds</code>，并且在 <code>&lt;TodoList&gt;</code> 中使用。</p><p>首先我们需要安装 Reselect:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">npm</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">install</span><span class="token plain"> reselect</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>接着我们导入且调用 <code>createSelector</code>。我们最初的 <code>selectTodoIds</code> 函数是在 <code>TodoList.js</code> 中定义的，但更常见的是选择器函数写在相关的切片文件中。因此，让我们将其添加到待办事项切片中：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> createSelector </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;reselect&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// omit reducer</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// omit action creators</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> selectTodoIds </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// First, pass one or more &quot;input selector&quot; functions:</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Then, an &quot;output selector&quot; that receives all the input results as arguments</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// and returns a final result value</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>接下来, 在 <code>&lt;TodoList&gt;</code> 里使用:</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/TodoList.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> useSelector</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> shallowEqual </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> selectTodoIds </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./todosSlice&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">TodoListItem</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./TodoListItem&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">TodoList</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todoIds </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">selectTodoIds</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> renderedListItems </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> todoIds</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todoId</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">TodoListItem</span><span class="token plain"> key</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> id</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">ul className</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;todo-list&quot;</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">renderedListItems</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token plain">ul</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>这实际上与 <code>shallowEqual</code> 比较函数的行为略有不同。每当 <code>state.todos</code> 数组更改时，我们都会创建一个新的 todo IDs 数组。这包括对待办事项的任何不可变更新，例如切换其 <code>completed</code> 字段，因为我们必须为不可变更新创建一个新数组。</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>仅当您实际从原始数据派生其他值时，记忆选择器才有用。如果只是查找并返回现有值，则可以将选择器保留为普通函数。</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="具有多个参数的-selectors"></a>具有多个参数的 Selectors<a class="hash-link" href="#具有多个参数的-selectors" title="Direct link to heading">#</a></h3><p>我们的待办事项应用程序应该能够根据其完成状态过滤可见的待办事项。让我们编写一个记忆选择器，返回经过过滤的待办事项列表。 </p><p>我们知道我们需要整个 <code>todos</code> 数组作为 output selector 的一个参数。我们还需要传入当前完成状态筛选器值。我们将添加一个单独的 &quot;input selector&quot; 来提取每个值，并将结果传递给 &quot;output selector&quot;。</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> createSelector </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;reselect&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">StatusFilters</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../filters/filtersSlice&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// omit other code</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> selectFilteredTodos </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// First input selector: all todos</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Second input selector: current status filter</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Output selector: receives both values</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todos</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> status</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">status </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access maybe-class-name">All</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> todos</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> completedStatus </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> status </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access maybe-class-name">Completed</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// Return either active or completed todos based on filter</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">filter</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> completedStatus</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>:::警告</p><p>请注意，我们现在在两个切片之间添加了一个导入依赖关系 - <code>todosSlice</code> 正在从 <code>filtersSlice</code> 导入一个值。这是合法的，但要小心。<strong>如果两个切片 <em>都在</em> 尝试从彼此导入某些内容，则最终可能会遇到“循环导入依赖项”问题，从而导致代码崩溃</strong>。如果发生这种情况，请尝试将一些常用代码移动到其自己的文件中，然后改为从该文件导入。</p><p>:::</p><p>现在，我们可以使用这个新的 &quot;filtered todos&quot; 选择器作为另一个选择器的输入，该选择器返回这些待办事项的 ID：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> selectFilteredTodoIds </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Pass our other memoized selector as an input</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  selectFilteredTodos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// And derive data in the output selector</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">filteredTodos</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> filteredTodos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>如果我们在 <code>&lt;TodoList&gt;</code> 使用 <code>selectFilteredTodoIds</code>，那么我们应该能够将几个待办事项标记为已完成：</p><p><img alt="Todo app - todos marked completed" src="/assets/images/todos-app-markedCompleted-fe1ddaba1c85e3f9841728d39459d126.png"></p><p>然后将列表筛选为 <em>只</em> 显示已完成的待办事项：</p><p><img alt="Todo app - todos marked completed" src="/assets/images/todos-app-showCompleted-6eeff512e106457fd4fb469d2f66337d.png"></p><p>然后，我们可以扩展我们的 <code>selectFilteredTodos</code>，以便在选择中也包括颜色过滤：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> selectFilteredTodos </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// First input selector: all todos</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  selectTodos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Second input selector: all filter values</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Output selector: receives both values</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todos</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> filters</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> status</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> colors </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> filters</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> showAllCompletions </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> status </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access maybe-class-name">All</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">showAllCompletions </span><span class="token operator" style="color:#F8F8F2">&amp;&amp;</span><span class="token plain"> colors</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> todos</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> completedStatus </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> status </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access maybe-class-name">Completed</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// Return either active or completed todos based on filter</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">filter</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> statusMatches </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        showAllCompletions </span><span class="token operator" style="color:#F8F8F2">||</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> completedStatus</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> colorMatches </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> colors</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">||</span><span class="token plain"> colors</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">includes</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">color</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> statusMatches </span><span class="token operator" style="color:#F8F8F2">&amp;&amp;</span><span class="token plain"> colorMatches</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>请注意，通过将逻辑封装在此选择器中，即使更改了筛选行为，我们的组件也不需要更改。现在我们可以同时按状态和颜色进行过滤：</p><p><img alt="Todo app - status and color filters" src="/assets/images/todos-app-selectorFilters-9ebfc37b389c997e011aff74d525a1aa.png"></p><p>最后，我们的代码在几个地方查找 <code>state.todos</code>。在完成本节的其余部分时，我们将对该状态的设计方式进行一些更改，因此我们将提取一个 <code>selectTodos</code> 选择器并在任何地方使用它。我们还可以将 <code>selectTodoById</code> 移动到 <code>todosSlice</code> 中：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectTodos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectTodoById</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> todoId</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">selectTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">find</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> todoId</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>学习更多关于怎样使用 Reselect 和记忆化 selectors ，请看：</p><ul><li>The <a href="https://github.com/reduxjs/reselect" target="_blank" rel="noopener noreferrer">Reselect docs</a></li><li><a href="https://blog.isquaredsoftware.com/2017/12/idiomatic-redux-using-reselect-selectors/" target="_blank" rel="noopener noreferrer">Idiomatic Redux: Using Reselect Selectors for Encapsulation and Performance</a></li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="异步请求状态"></a>异步请求状态<a class="hash-link" href="#异步请求状态" title="Direct link to heading">#</a></h2><p>我们使用异步 thunk 从服务器获取待办事项的初始列表。由于我们使用的是伪造的服务器 API，因此该响应会立即返回。在实际应用中，API 调用可能需要一段时间才能解决。在这种情况下，在我们等待响应完成时，通常会显示某种加载微调器（loading spinner）。</p><p>这通常在 Redux 应用中通过以下方式进行处理：</p><ul><li>具有某种“加载状态”值来指示请求的当前状态</li><li><em>在</em> 进行 API 调用 <em>前</em> dispatch &quot;request started&quot; action，该 dispatch 通过更改加载状态值进行处理</li><li>请求完成时再次更新加载状态值，以指示调用已完成</li></ul><p>然后，UI 层在请求进行时显示加载微调器，并在请求完成时切换到显示实际数据。</p><p>我们将更新待办事项切片以跟踪加载状态值，并 dispatch 一个额外的 <code>&#x27;todos/todosLoading&#x27;</code> action 作为 <code>fetchTodos</code> thunk 的一部分。</p><p>现在，我们的 todosReducer 的 <code>state</code> 只是 todos 本身的数组。如果我们想跟踪 todos 切片中的加载状态，我们需要将 todos 状态重新组织为具有 todos 数组 <em>和</em> 加载状态值的对象。这也意味着重写 reducer 逻辑以处理额外的嵌套：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">todosReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoToggled&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">!==</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> todo</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token literal-property property" style="color:#F92672">completed</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// omit other cases</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword module" style="color:#F92672">default</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> state</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// omit action creators</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectTodos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>这里有一些重要的事情需要注意：</p><ul><li>todos 数组现在作为 <code>state.entities</code> 嵌套在 <code>todosReducer</code> 状态对象中。&quot;entities&quot; 这个词是一个术语，意思是“具有 ID 的唯一项目”，它确实描述了我们的待办事项对象。</li><li>这也意味着数组嵌套在 <em>整个</em> Redux state 对象中，作为 <code>state.todos.entities</code></li><li>我们现在必须在 Reducer 中执行额外的步骤来复制额外的嵌套级别，以进行正确的不可变更新，例如 <code>state</code> 对象 -&gt; <code>entities</code> 数组 -&gt; <code>todo</code> 对象</li><li>由于代码的其余部分是 <em>只</em> 通过选择器访问 todos 状态，<strong>我们只需要更新 <code>selectTodo</code> 选择器</strong> - 即使我们大大重塑了状态，UI 的其余部分仍将继续按预期工作。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="加载状态的枚举值"></a>加载状态的枚举值<a class="hash-link" href="#加载状态的枚举值" title="Direct link to heading">#</a></h3><p>您还会注意到，我们已将加载状态字段定义为字符串枚举：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#c6cad2">// or: &#x27;loading&#x27;, &#x27;succeeded&#x27;, &#x27;failed&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>而不是 <code>isLoading</code> 布尔值。</p><p>布尔值将我们限制在两种可能性：“加载”或“不加载”。实际上，<strong>请求实际上可能处于 <em>许多</em> 不同的状态</strong>，例如：</p><ul><li>根本没有开始</li><li>进行中</li><li>成功</li><li>失败</li><li>成功, 但又回到了我们可能想要重新筛选的情况</li></ul><p>还有一种可能是应用逻辑应仅根据某些操作在特定状态之间转换，这更难使用布尔值实现。</p><p>因此，我们建议 <strong>将加载状态存储为字符串枚举值，而不是布尔标志</strong>。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>有关为什么加载状态应为枚举的详细说明，请参阅：</p><ul><li><a href="/style-guide/style-guide#treat-reducers-as-state-machines">Redux Style Guide: treat reducers as state machines</a></li></ul></div></div><p>在此基础上，我们将添加一个新的 &quot;loading&quot; action，该操作会将我们的状态设置为 <code>&#x27;loading&#x27;</code>，并更新 &quot;loaded&quot; action 以将状态标志重置 <code>&#x27;idle&#x27;</code>：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">todosReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// omit other cases</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoading&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;loading&#x27;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword module" style="color:#F92672">default</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> state</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// omit action creators</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// Thunk function</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">fetchTodos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">todosLoading</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">todosLoaded</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>但是，在我们尝试在 UI 中显示这一点之前，我们需要修改假服务器 API，以向 API 调用添加人为延迟。打开 <code>src/api/server.js</code>，然后在第 63 行周围查找此注释掉的行：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/api/server.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">new</span><span class="token plain"> </span><span class="token class-name">Server</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">routes</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">this</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">namespace</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;fakeApi&#x27;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// this.timing = 2000</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// omit other code</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>如果您取消注释该行，假服务器将为我们的应用程序进行的每个API调用添加2秒的延迟，这使我们有足够的时间实际看到正在显示的加载微调器。</p><p>现在，我们可以读取 <code>&lt;TodoList&gt;</code> 组件中的加载状态值，并根据该值显示加载微调器。</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/TodoList.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// omit imports</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">TodoList</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todoIds </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">selectFilteredTodoIds</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> loadingStatus </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">loadingStatus </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;loading&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;todo-list&quot;</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;loader&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token plain">div</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> renderedListItems </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> todoIds</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todoId</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">TodoListItem</span><span class="token plain"> key</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> id</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">ul className</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;todo-list&quot;</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">renderedListItems</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token plain">ul</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>在实际应用中，我们还希望处理 API 故障错误和其他潜在情况。</p><p>以下是启用加载状态后应用的外观（若要再次查看微调器，请重新加载应用预览或在新选项卡（tag）中打开它）：</p><iframe class="codesandbox" src="https://codesandbox.io/embed/github/reduxjs/redux-fundamentals-example-app/tree/checkpoint-7-asyncLoading/?fontsize=14&amp;hidenavigation=1&amp;theme=dark&amp;runonclick=1" title="redux-fundamentals-example-app" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="flux-standard-actions"></a>Flux Standard Actions<a class="hash-link" href="#flux-standard-actions" title="Direct link to heading">#</a></h2><p>Redux store 本身实际上并不关心您在 action 中放入了哪些字段。它只关心 <code>action.type</code> 是否存在并具有值，并且常规的 Redux action 始终使用字符串表示 <code>action.type</code>。这意味着您可以将任何其他字段放入所需的 action 中。也许我们可以用 <code>action.todo</code> 来表示 &quot;todo add&quot; 动作，或者 <code>action.color</code>，依此类推。</p><p>但是，如果每个 action 对其数据字段使用不同的字段名称，则很难提前知道每个 reducer 中需要处理哪些字段。</p><p>这就是为什么 Redux 社区提出<a href="https://github.com/redux-utilities/flux-standard-action#motivation" target="_blank" rel="noopener noreferrer">&quot;Flux Standard Actions&quot; 约定</a>, 简称 &quot;FSA&quot;。这是有关如何在 action 对象内部组织字段的建议方法，以便开发人员始终知道哪些字段包含哪些类型的数据。FSA 模式在 Redux 社区中被广泛使用，事实上，您在整个教程中已经使用它。</p><p>FSA 约定表达了：</p><ul><li>如果您的 action 对象具有任何实际数据，则 action 的“数据”值应始终位于 <code>action.payload</code> 中</li><li>action 还可以具有包含额外描述性数据的 <code>action.meta</code> 字段</li><li>action 可能具有包含错误信息的 <code>action.error</code> 字段</li></ul><p>所以，<em>所有</em> Redux actions 必须：</p><ul><li>是一个普通的 JS 对象</li><li>必须有 <code>type</code> 字段</li></ul><p>如果您使用 FSA 模式编写 action，则 action 可能会:</p><ul><li>拥有一个 <code>payload</code> 字段</li><li>拥有一个 <code>error</code> 字段</li><li>拥有一个 <code>meta</code> 字段</li></ul><details class="detailed-explanation"><summary><h4>Detailed Explanation: FSAs and Errors</h4></summary><p>FSA 规范规定：</p><blockquote><p>如果 action 表示错误，则可选的 <code>error</code> 属性可以设置为 <code>true</code>。
<code>error</code> 为真的操作类似于 rejected Promise。按照惯例，<code>payload</code> 应该是一个错误对象。
如果 <code>error</code> 除 <code>true</code> 之外还有任何其他值，包括 <code>undefined</code> 和 <code>null</code>，则该action 不得解释为错误。</p></blockquote><p>FSA 规范还反对为 &quot;loading succeeded&quot; 和 &quot;loading failed&quot; 等内容提供特定的 action 类型。</p><p>然而，在实践中，Redux 社区忽略了使用 <code>action.error</code> 作为布尔标志的想法，而是选择了单独的 action 类型，如 <code>todos/todosLoadingSucceeded</code> 和 <code>todos/todosLoadingFailed</code>。这是因为检查这些 action 类型比首先处理 <code>todos/todosLoaded</code> <em>再</em> 检查 <code>if （action.error）</code> 要容易得多。</p><p>你可以执行任何一种更适合你的方法，但大多数应用使用单独的 action 类型来表示成功和失败。</p></details><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="规范化-state"></a>规范化 State<a class="hash-link" href="#规范化-state" title="Direct link to heading">#</a></h2><p>到目前为止，我们已将待办事项保存在一个数组中。这是合理的，因为我们从服务器接收数据作为数组，我们还需要循环访问待办事项以在 UI 中将它们显示为列表。</p><p>但是，在较大的 Redux 应用中，通常将数据存储在<strong>规范化状态结构</strong>中。“规范化”是指：</p><ul><li>确保每条数据只有一个副本</li><li>以允许按 ID 直接查找项目（items）的方式存储项目</li><li>基于 ID 引用其他项目，而不是复制整个项目</li></ul><p>例如，在博客应用程序中，您可能具有指向 <code>User</code> 和 <code>Comment</code> 对象的 <code>Post</code>  对象。同一个人可能有很多帖子，因此，如果每个 <code>Post</code> 对象都包含整个 <code>User</code>，我们将拥有同一个 <code>User</code> 对象的许多副本。相反，若 <code>Post</code> 对象的用户 ID 值为 <code>post.user</code>，然后我们可以按 ID 查找 <code>User</code> 对象，如 <code>state.users[post.user]</code>。</p><p>这意味着我们通常将数据组织为对象而不是数组，其中项目 ID 是键，项目本身是值，如下所示：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> rootState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">todos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token number" style="color:#AE81FF">2</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">id</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">2</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">text</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;Buy milk&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">completed</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token number" style="color:#AE81FF">7</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">id</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">7</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">text</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;Clean room&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">completed</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>让我们转换 todos 切片，以规范化的形式存储 todos。这将需要对我们的 reducer 逻辑进行一些重大更改，并更新 selectors：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/todos/todosSlice</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">todosReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> todo</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoToggled&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todoId </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token literal-property property" style="color:#F92672">completed</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/colorSelected&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> color</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> todoId </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">            color</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoDeleted&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">delete</span><span class="token plain"> newEntities</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> newEntities</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/allCompleted&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">values</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">newEntities</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">forEach</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        newEntities</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token literal-property property" style="color:#F92672">completed</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">true</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> newEntities</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/completedCleared&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">values</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">newEntities</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">forEach</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token keyword" style="color:#F92672">delete</span><span class="token plain"> newEntities</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> newEntities</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoading&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;loading&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">forEach</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        newEntities</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> todo</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">status</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token literal-property property" style="color:#F92672">entities</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> newEntities</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword module" style="color:#F92672">default</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> state</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// omit action creators</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectTodoEntities</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">entities</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> selectTodos </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">selectTodoEntities</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token parameter">entities</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">values</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">entities</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectTodoById</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> todoId</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">selectTodoEntities</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>由于我们的 <code>state.entities</code> 字段现在是一个对象而不是数组，因此我们必须使用嵌套对象展开运算符来更新数据而不是数组操作。此外，我们不能像循环数组那样循环访问对象，因此在几个地方，我们必须使用 <code>Object.values（entities</code> 来获取待办事项的数组，以便我们可以循环访问它们。</p><p>好消息是，由于我们使用 selectors 来封装状态查找，因此我们的 UI 仍然不必更改。坏消息是，reducer 代码实际上更长，更复杂。</p><p>这里的部分问题是<strong>此待办事项应用程序示例不是大型实际应用程序</strong>。因此，规范化状态在此特定应用中没有那么有用，并且更难看到潜在的好处。</p><p>幸运的是，在<a href="/tutorials/fundamentals/part-8-modern-redux">第 8 节：基于 Redux Toolkit 的现代化 Redux</a>中，我们将看到一些方法来大大缩短用于管理规范化状态的 reducer 逻辑。</p><p>目前，要了解的重要事项是：</p><ul><li>规范化在 Redux 应用中 <em>很</em> 常用</li><li>主要好处是能够通过 ID 查找单个项目，并确保 state 中只存在项目的一个副本</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>有关规范化对 Redux 有用的更多详细信息，请参阅：</p><ul><li><a href="/recipes/structuring-reducers/normalizing-state-shape">Structuring Reducers: Normalizing State Shape</a></li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="thunks-和-promises"></a>Thunks 和 Promises<a class="hash-link" href="#thunks-和-promises" title="Direct link to heading">#</a></h2><p>对于本节，我们还有最后一个模式要看。我们已经了解了如何基于 dispatch action 在 Redux store 中处理加载状态。如果我们需要查看组件 thunk 的结果，该怎么办？</p><p>每当您调用 <code>store.dispatch(action)</code> 时，<code>dispatch</code> 实际上会返回 <code>action</code> 作为其结果。然后，中间件可以修改该行为并返回一些其他值。</p><p>我们已经看到，Redux Thunk 中间件允许我们将一个函数传递给 <code>dispatch</code>，调用该函数，然后返回结果：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">reduxThunkMiddleware.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">reduxThunkMiddleware</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// If the &quot;action&quot; is actually a function instead...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">typeof</span><span class="token plain"> action </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;function&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// then call the function and pass `dispatch` and `getState` as arguments</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// Also, return whatever the thunk function returns</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">action</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">storeAPI</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">dispatch</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> storeAPI</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Otherwise, it&#x27;s a normal action - send it onwards</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">next</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>这意味着<strong>我们可以编写返回 promise 的 thunk 函数，并在我们的组件中等待 promise 状态变化</strong>。</p><p>我们已经有 <code>&lt;Header&gt;</code> 组件 dispatching 一个 thunk，以将新的待办事项条目保存到服务器。让我们在 <code>&lt;Header&gt;</code> 组件中添加一些加载状态，然后禁用文本输入，并在等待服务器时显示另一个加载微调器：</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#272822" class="codeBlockTitle_oQzk">src/features/header/Header.js</div><div class="codeBlockContent_csEI js"><div tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">Header</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">text</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setText</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">status</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setStatus</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useDispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">handleChange</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">setText</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">handleKeyDown</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// If the user pressed the Enter key:</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> trimmedText </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">trim</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">which</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">13</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&amp;&amp;</span><span class="token plain"> trimmedText</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Create and dispatch the thunk function itself</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">setStatus</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;loading&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Wait for the promise returned by saveNewTodo</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">saveNewTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">trimmedText</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// And clear out the text input</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">setText</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">setStatus</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;idle&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> isLoading </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> status </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;loading&#x27;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> placeholder </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> isLoading </span><span class="token operator" style="color:#F8F8F2">?</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;What needs to be done?&#x27;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> loader </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> isLoading </span><span class="token operator" style="color:#F8F8F2">?</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;loader&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">header className</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;header&quot;</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">input</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        className</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;new-todo&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        placeholder</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        autoFocus</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token boolean" style="color:#AE81FF">true</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        value</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">text</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        onChange</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">handleChange</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        onKeyDown</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">handleKeyDown</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">        disabled</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">isLoading</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">loader</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token plain">header</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token maybe-class-name">Header</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>现在，如果我们添加一个待办事项，我们将在标题中看到一个微调器：</p><p><img alt="Todo app - component loading spinner" src="/assets/images/todos-app-headerLoading-9b4bca9cb4675bf35df09a2e709ecccb.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="你学到了"></a>你学到了<a class="hash-link" href="#你学到了" title="Direct link to heading">#</a></h2><p>如您所见，还有几种在 Redux 应用中广泛使用的其他模式。这些模式不是必需的，最初可能涉及编写更多代码，但它们提供了一些好处，例如使逻辑可重用、封装实现细节、提高应用性能以及使查找数据更容易。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>有关这些模式存在的原因以及如何使用Redux的更多详细信息，请参阅：</p><ul><li><a href="https://blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-1/" target="_blank" rel="noopener noreferrer">Idiomatic Redux: The Tao of Redux, Part 1 - Implementation and Intent</a></li><li><a href="https://blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-2/" target="_blank" rel="noopener noreferrer">Idiomatic Redux: The Tao of Redux, Part 2 - Practice and Philosophy</a></li></ul></div></div><p>以下是我们的应用在完全转换为使用这些模式后的样子：</p><iframe class="codesandbox" src="https://codesandbox.io/embed/github/reduxjs/redux-fundamentals-example-app/tree/checkpoint-8-normalizedState/?fontsize=14&amp;hidenavigation=1&amp;theme=dark&amp;runonclick=1" title="redux-fundamentals-example-app" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>总结</h5></div><div class="admonition-content"><ul><li><strong>Action creators 函数可以封装关于 action 对象和 thunks 的逻辑</strong><ul><li>Action creators 可以接受参数并包含设置逻辑，并返回最终的 action 对象或 thunk 函数</li></ul></li><li><strong>记忆化 selectors 有助于提高 Redux 应用性能</strong><ul><li>Reselect 有一个 <code>createSelector</code> API 可以生成记忆化 selectors</li><li>如果给记忆化 selectors 传入相同的参数，将返回相同的结果（引用）</li></ul></li><li><strong>请求状态应存储为枚举值，而不是布尔值</strong><ul><li>使用 <code>&#x27;idle&#x27;</code> 和 <code>&#x27;loading&#x27;</code> 等枚举有助于一致地跟踪状态</li></ul></li><li><strong>&quot;Flux Standard Actions&quot; 是管理 action 对象公认的约定</strong><ul><li>Actions 的数据放在 <code>payload</code> 字段里，<code>meta</code> 放额外的描述，<code>error</code> 放错误信息</li></ul></li><li><strong>规范化状态使按 ID 查找项目变得更加容易</strong><ul><li>规范化数据存储在对象而不是数组中，项目 ID 作为键</li></ul></li><li><strong>Thunks 可以从 <code>dispatch</code> 中返回 promise 值</strong><ul><li>组件内可以等待异步 thunks 完成，然后做更多的工作</li></ul></li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="下一步"></a>下一步<a class="hash-link" href="#下一步" title="Direct link to heading">#</a></h2><p>“手动”编写所有这些代码可能既耗时又困难。<strong>这就是我们推荐你用官方库 <a href="https://redux-toolkit.js.org" target="_blank" rel="noopener noreferrer">Redux Toolkit</a> 去写 Redux 逻辑的原因</strong>。</p><p>Redux Toolkit 包含的 API 可<strong>帮助您编写所有典型的 Redux 使用模式，且代码较少</strong>。它还有助于<strong>防止常见错误</strong>，例如意外改变状态。</p><p>在<a href="/tutorials/fundamentals/part-8-modern-redux">第 8 节: 现代化 Redux</a>, 我们将介绍如何使用 Redux Toolkit 来简化我们迄今为止编写的所有代码。</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tutorials/fundamentals/part-6-async-logic"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Redux Fundamentals, Part 6: Async Logic and Data Fetching</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tutorials/fundamentals/part-8-modern-redux"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Redux Fundamentals, Part 8: Modern Redux with Redux Toolkit »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#action-creators" class="table-of-contents__link">Action Creators</a><ul><li><a href="#using-action-creators" class="table-of-contents__link">Using Action Creators</a></li></ul></li><li><a href="#记忆化-selectors" class="table-of-contents__link">记忆化 Selectors</a><ul><li><a href="#结合-createselector-记忆化-selectors" class="table-of-contents__link">结合 <code>createSelector</code> 记忆化 Selectors</a></li><li><a href="#具有多个参数的-selectors" class="table-of-contents__link">具有多个参数的 Selectors</a></li></ul></li><li><a href="#异步请求状态" class="table-of-contents__link">异步请求状态</a><ul><li><a href="#加载状态的枚举值" class="table-of-contents__link">加载状态的枚举值</a></li></ul></li><li><a href="#flux-standard-actions" class="table-of-contents__link">Flux Standard Actions</a></li><li><a href="#规范化-state" class="table-of-contents__link">规范化 State</a></li><li><a href="#thunks-和-promises" class="table-of-contents__link">Thunks 和 Promises</a></li><li><a href="#你学到了" class="table-of-contents__link">你学到了</a></li><li><a href="#下一步" class="table-of-contents__link">下一步</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started">入门</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials/essentials/part-1-overview-concepts">教程</a></li><li class="footer__item"><a class="footer__link-item" href="/faq">常见问题</a></li><li class="footer__item"><a class="footer__link-item" href="/api/api-reference">API 文档</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">社区</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/0ZcbPKXt5bZ6au5t" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reactiflux Discord</a></li><li class="footer__item"><a href="http://stackoverflow.com/questions/tagged/redux" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started#help-and-discussion">Feedback</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/camsong/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright © 2015–2022 Dan Abramov and Cam Song.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9044bd3c.js"></script>
<script src="/assets/js/main.983ddc03.js"></script>
</body>
</html>